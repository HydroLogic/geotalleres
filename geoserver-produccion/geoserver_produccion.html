
<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>GeoServer en producción &mdash; geotalleres-teoria 1 documentation</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/geotalleres.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootswatch-3.1.0/readable/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.1.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="geotalleres-teoria 1 documentation" href="../index.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body>

  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          GeoTalleres</a>
        <span class="navbar-text navbar-version pull-left"><b>1</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Nav <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../geopython/index.html">Geoprocesamiento con Python</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../geopython/miniintro_python.html">Mini intro a python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geopython/librerias.html">Librerías GEO interesantes en Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geopython/instalacion.html">Instalación</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geopython/rasterio.html">rasterio</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geopython/fiona.html">fiona</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geopython/shapely.html">shapely</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geopython/fiona_shapely.html">fiona y shapely</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">GeoServer en producción</a><ul>
<li><a class="reference internal" href="#nivel-de-logging">Nivel de <em>logging</em></a></li>
<li><a class="reference internal" href="#limitacion-del-servicio-wms">Limitación del servicio WMS</a><ul>
<li><a class="reference internal" href="#tiempo-y-memoria">Tiempo y memoria</a></li>
<li><a class="reference internal" href="#numero-de-llamadas-concurrentes">Número de llamadas concurrentes</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
              
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="../_sources/geoserver-produccion/geoserver_produccion.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12">
      
  <div class="section" id="geoserver-en-produccion">
<h1>GeoServer en producción<a class="headerlink" href="#geoserver-en-produccion" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<table border="1" class="docutils">
<colgroup>
<col width="24%" />
<col width="76%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Fecha</th>
<th class="head">Autores</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>6 Feb 2014</td>
<td><ul class="first last simple">
<li>Víctor González (<a class="reference external" href="mailto:victor&#46;gonzalez&#37;&#52;&#48;geomati&#46;co">victor<span>&#46;</span>gonzalez<span>&#64;</span>geomati<span>&#46;</span>co</a>)</li>
<li>Fernando González (<a class="reference external" href="mailto:fernando&#46;gonzalez&#37;&#52;&#48;fao&#46;org">fernando<span>&#46;</span>gonzalez<span>&#64;</span>fao<span>&#46;</span>org</a>)</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>©2014 FAO Forestry</p>
<p class="last">Excepto donde quede reflejado de otra manera, la presente documentación se halla bajo licencia : Creative Commons (Creative Commons - Attribution - Share Alike: <a class="reference external" href="http://creativecommons.org/licenses/by-sa/3.0/deed.es">http://creativecommons.org/licenses/by-sa/3.0/deed.es</a>)</p>
</div>
<p>Existen varias optimizaciones a tener en cuenta para poner GeoServer en producción. Aquí tendremos en cuenta únicamente la limitación del servicio WMS y la configuración del nivel de <em>logging</em>. Para una optimización más completa se puede consultar la <a class="reference external" href="http://boundlessgeo.com/whitepaper/geoserver-production-2/#limit">documentación oficial de GeoServer</a> (en inglés). En la presente documentación asumimos que GeoServer se está ejecutando sobre el contenedor Tomcat, por lo que también veremos cómo limitar el número máximo de conexiones simultáneas en Tomcat.</p>
<div class="section" id="nivel-de-logging">
<h2>Nivel de <em>logging</em><a class="headerlink" href="#nivel-de-logging" title="Permalink to this headline">¶</a></h2>
<p>Para realizar las optimizaciones, primero tenemos que abrir interfaz web de administración y acceder a la configuración global de GeoServer:</p>
<img alt="../_images/gs_global.png" class="align-center" src="../_images/gs_global.png" />
<p>Una vez allí, únicamente hay que cambiar el <em>Perfil de registro</em> a <em>PRODUCTION_LOGGING</em> y pulsar <em>Enviar</em> al final de la página:</p>
<img alt="../_images/gs_logging.png" class="align-center" src="../_images/gs_logging.png" />
<p>También es posible cambiar la <em>Ubicación del registro</em> desde aquí, aunque se recomienda mantener la ubicación por defecto.</p>
</div>
<div class="section" id="limitacion-del-servicio-wms">
<h2>Limitación del servicio WMS<a class="headerlink" href="#limitacion-del-servicio-wms" title="Permalink to this headline">¶</a></h2>
<p>En cuanto al servicio WMS, vamos a limitar las peticiones recibidas en dos niveles. Por un lado limitaremos el tiempo y la memoria necesarios para procesar una petición de la llamada GetMap, y por otro lado el número de peticiones simultáneas que acepta el dicho servicio.</p>
<div class="section" id="tiempo-y-memoria">
<h3>Tiempo y memoria<a class="headerlink" href="#tiempo-y-memoria" title="Permalink to this headline">¶</a></h3>
<p>Para limitar el tiempo y la memoria requeridos por una única petición WMS en GeoServer, deberemos acceder a <em>WMS</em> en la interfaz web:</p>
<img alt="../_images/gs_wms.png" class="align-center" src="../_images/gs_wms.png" />
<p>Una vez aquí, buscaremos el apartado <em>Límites de consumo de recursos</em>, donde podremos modificar tanto la memoria como el tiempo máximos de renderizado:</p>
<img alt="../_images/gs_wms_render_limits.png" class="align-center" src="../_images/gs_wms_render_limits.png" />
</div>
<div class="section" id="numero-de-llamadas-concurrentes">
<h3>Número de llamadas concurrentes<a class="headerlink" href="#numero-de-llamadas-concurrentes" title="Permalink to this headline">¶</a></h3>
<p>Por otro lado, es interesante limitar el número de peticiones simultáneas que ha de manejar GeoServer. El número recomendado de peticiones simultáneas para GeoServer es 20.</p>
<p>La manera más sencilla de conseguir esto es limitar el número de peticiones en Tomcat.</p>
<p>Para limitar el número de peticiones simultáneas en Tomcat hay que modificar el fichero <em>$TOMCAT/conf/server.xml</em>. Aquí buscaremos el conector con el puerto 8080 y añadiremos el parámetro <em>maxThreads</em> para determinar el número máximo de peticiones:</p>
<div class="highlight-python"><pre>&lt;Server port="8005" shutdown="SHUTDOWN"&gt;
  ...
  &lt;Connector port="8080" protocol="HTTP/1.1"
    ConnectionTimeout="20000" redirectPort="8443"
    maxThreads="20" minSpareThreads="20" /&gt;
  ...
&lt;/Server&gt;</pre>
</div>
<p>En el caso de que se esté utilizando Tomcat dentro del servidor Apache y se esté utilizando el conector AJP, el parámetro <em>maxThreads</em> se deberá añadir en el conector adecuado:</p>
<div class="highlight-python"><pre>&lt;Server port="8005" shutdown="SHUTDOWN"&gt;
  ...
  &lt;Connector port="8009" protocol="AJP/1.3"
    connectionTimeout="60000" redirectPort="8443"
    maxThreads="20" minSpareThreads="20" /&gt;
  ...
&lt;/Server&gt;</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">En caso de no saber si se está utilizando el conector AJP, se recomienda establecer los límites igualmente.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Es <strong>MUY</strong> importante especificar el valor de <em>connectionTimeout</em>, ya que para el conector AJP por defecto es infinito, lo cual puede resultar en un bloqueo del servidor si se reciben demasiadas peticiones simultáneamente.</p>
</div>
<p>Además, también es posible controlar el número de peticiones simultáneas desde GeoServer. Para ello hay que utilizar el módulo <strong>control-flow</strong>, que no se encuentra instalado por defecto en GeoServer.</p>
<p>Para instalarlo primero hay que descargarlo de la web de GeoServer, en la sección de descargas tras seleccionar la versión de GeoServer en el apartado <em>Extensiones</em>. El fichero comprimido que se descarga contiene otro fichero llamado <em>control-flow-&lt;version&gt;.jar</em> que hay que copiar en <em>$TOMCAT/webapps/geoserver/WEB-INF/lib</em>.</p>
<p>Una vez instalado el módulo, para configurarlo hay que crear un fichero de configuración en <em>$TOMCAT/webapps/geoserver/data</em> con el nombre <em>controlflow.properties</em>. En dicho fichero escribiremos el siguiente contenido para limitar el número de peticiones simultáneas de imágenes para el servicio WMS:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">ows</span><span class="o">.</span><span class="n">wms</span><span class="o">.</span><span class="n">getmap</span><span class="o">=</span><span class="mi">16</span>
</pre></div>
</div>
<p>El número de peticiones que asignamos al servicio WMS depende del uso que se vaya a hacer de nuestro servidor. La configuración anterior de Tomcat únicamente admite 20 peticiones simultáneas en total. En el caso de que usemos el servidor principalmente para WMS podemos, como en el ejemplo, dedicar 16 al servicio WMS y dejar 4 peticiones simultáneas para cualquier otro servicio o petición a GeoServer.</p>
<p>En la <a class="reference external" href="http://docs.geoserver.org/stable/en/user/extensions/controlflow/index.html">documentación oficial de GeoServer</a> (en inglés) se puede encontrar mayor detalle sobre la configuración del módulo <em>control-flow</em>.</p>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2013, Varios.<br/>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.<br/>
    </p>
  </div>
</footer>
  </body>
</html>