
<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>PostgreSQL &mdash; geotalleres-teoria 1 documentation</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/geotalleres.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootswatch-3.1.0/readable/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.1.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="geotalleres-teoria 1 documentation" href="../index.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body>

  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          GeoTalleres</a>
        <span class="navbar-text navbar-version pull-left"><b>1</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Nav <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../geopython/index.html">Geoprocesamiento con Python</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../geopython/miniintro_python.html">Mini intro a python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geopython/librerias.html">Librerías GEO interesantes en Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geopython/instalacion.html">Instalación</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geopython/rasterio.html">rasterio</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geopython/fiona.html">fiona</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geopython/shapely.html">shapely</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geopython/fiona_shapely.html">fiona y shapely</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">PostgreSQL</a><ul>
<li><a class="reference internal" href="#introduccion">Introducción</a></li>
<li><a class="reference internal" href="#arquitectura-cliente-servidor">Arquitectura cliente/servidor</a></li>
<li><a class="reference internal" href="#creacion-de-una-base-de-datos">Creación de una base de datos</a></li>
<li><a class="reference internal" href="#acceso-a-una-base-de-datos">Acceso a una base de datos</a></li>
<li><a class="reference internal" href="#psql">psql</a></li>
<li><a class="reference internal" href="#consola-psql-interactiva">Consola psql interactiva</a><ul>
<li><a class="reference internal" href="#ayuda-de-psql">Ayuda de psql</a></li>
</ul>
</li>
<li><a class="reference internal" href="#cargando-informacion-desde-shapefile-shp2pgsql">Cargando información desde shapefile: shp2pgsql</a></li>
<li><a class="reference internal" href="#mas-informacion">Más información</a></li>
<li><a class="reference internal" href="#referencias">Referencias</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
              
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="../_sources/postgresql/postgresql.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12">
      
  <div class="section" id="postgresql">
<h1>PostgreSQL<a class="headerlink" href="#postgresql" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Fecha</th>
<th class="head">Autores</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>1 Septiembre 2012</td>
<td><ul class="first last simple">
<li>Fernando González (<a class="reference external" href="mailto:fernando&#46;gonzalez&#37;&#52;&#48;geomati&#46;co">fernando<span>&#46;</span>gonzalez<span>&#64;</span>geomati<span>&#46;</span>co</a>)</li>
<li>Micho García (<a class="reference external" href="mailto:micho&#46;garcia&#37;&#52;&#48;geomati&#46;co">micho<span>&#46;</span>garcia<span>&#64;</span>geomati<span>&#46;</span>co</a>)</li>
</ul>
</td>
</tr>
<tr class="row-odd"><td>24 Junio 2013</td>
<td><ul class="first last simple">
<li>Fernando González (<a class="reference external" href="mailto:fernando&#46;gonzalez&#37;&#52;&#48;fao&#46;org">fernando<span>&#46;</span>gonzalez<span>&#64;</span>fao<span>&#46;</span>org</a>)</li>
<li>Ramiro Mata (<a class="reference external" href="mailto:rmata&#37;&#52;&#48;zonageo&#46;com&#46;ar">rmata<span>&#64;</span>zonageo<span>&#46;</span>com<span>&#46;</span>ar</a>)</li>
<li>Leandro Roncoroni (<a class="reference external" href="mailto:lronco&#37;&#52;&#48;zonageo&#46;com&#46;ar">lronco<span>&#64;</span>zonageo<span>&#46;</span>com<span>&#46;</span>ar</a>)</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>©2012 Fernando González Cortés y Miguel García Coya</p>
<p>Excepto donde quede reflejado de otra manera, la presente documentación se halla bajo licencia : Creative Commons (Creative Commons - Attribution - Share Alike: <a class="reference external" href="http://creativecommons.org/licenses/by-sa/3.0/deed.es">http://creativecommons.org/licenses/by-sa/3.0/deed.es</a>)</p>
<p class="last">Los contenidos de este punto son inicialmente traducciones de la documentación oficial de PostgreSQL que han sido extendidos posteriormente.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>PostgreSQL is Copyright © 1996-2006 by the PostgreSQL Global Development Group and is distributed under the terms of the license of the University of California below.</p>
<p>Postgres95 is Copyright © 1994-5 by the Regents of the University of California.</p>
<p>Permission to use, copy, modify, and distribute this software and its documentation for any purpose, without fee, and without a written agreement
is hereby granted, provided that the above copyright notice and this paragraph and the following two paragraphs appear in all copies.</p>
<p>IN NO EVENT SHALL THE UNIVERSITY OF CALIFORNIA BE LIABLE TO ANY PARTY FOR DIRECT, INDIRECT, SPECIAL, INCI-
DENTAL, OR CONSEQUENTIAL DAMAGES, INCLUDING LOST PROFITS, ARISING OUT OF THE USE OF THIS SOFTWARE AND ITS
DOCUMENTATION, EVEN IF THE UNIVERSITY OF CALIFORNIA HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</p>
<p class="last">THE UNIVERSITY OF CALIFORNIA SPECIFICALLY DISCLAIMS ANY WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IM-
PLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE. THE SOFTWARE PROVIDED HERE-
UNDER IS ON AN “AS-IS” BASIS, AND THE UNIVERSITY OF CALIFORNIA HAS NO OBLIGATIONS TO PROVIDE MAINTENANCE,
SUPPORT, UPDATES, ENHANCEMENTS, OR MODIFICATIONS.</p>
</div>
<div class="section" id="introduccion">
<h2>Introducción<a class="headerlink" href="#introduccion" title="Permalink to this headline">¶</a></h2>
<p>El objetivo de este tutorial sobre <em>PostgreSQL</em> es que el usuario sea capaz
de crear y eliminar bases de datos y acceder a ellas para la manipulación de los
datos.</p>
<p>Por esto, los puntos siguientes están pensados para dar una introducción
simple a <em>PostgreSQL</em>, a los conceptos básicos sobre bases de datos relacionales
y al lenguaje SQL. No se requiere experiencia en
sistemas UNIX ni en programación.</p>
<p>Tras el tutorial, es posible continuar el aprendizaje leyendo la
documentación oficial del proyecto, en inglés, en la que se puede encontrar
abundante información sobre el lenguaje SQL, el desarrollo de
aplicaciones para PostgreSQL y la configuración y administración de servidores.</p>
</div>
<div class="section" id="arquitectura-cliente-servidor">
<h2>Arquitectura cliente/servidor<a class="headerlink" href="#arquitectura-cliente-servidor" title="Permalink to this headline">¶</a></h2>
<p>Al igual que el resto de componentes instalados, <em>PostgreSQL</em> utiliza un modelo
cliente/servidor, ya explicado en la introducción.</p>
<p>Las aplicaciones cliente pueden ser de naturaleza muy diversa: una herramienta
orientada a texto (psql), una aplicación gráfica (pgAdmin3), un servidor web que
accede a la base de datos para mostrar las páginas web, o una herramienta de
mantenimiento de bases de datos especializadas. Algunas aplicaciones de cliente
se suministran con la distribución <em>PostgreSQL</em> mientras que otras son desarrolladas por los usuarios.</p>
</div>
<div class="section" id="creacion-de-una-base-de-datos">
<h2>Creación de una base de datos<a class="headerlink" href="#creacion-de-una-base-de-datos" title="Permalink to this headline">¶</a></h2>
<p>El primer paso para trabajar con <em>PostgreSQL</em> es crear una base de datos. Para ello es necesario ejecutar
como usuario <em>postgres</em> el comando <em>createdb</em>:</p>
<div class="highlight-python"><pre>$ sudo su postgres
$ createdb mibd</pre>
</div>
<p>Si no se tiene acceso físico al servidor o se prefiere acceder de forma remota
es necesario utilizar un cliente SSH. La siguiente instrución:</p>
<div class="highlight-python"><pre>$ ssh geo@190.109.197.226</pre>
</div>
<p>conecta al servidor 190.109.197.226 con el usuario <em>geo</em>.</p>
<p>Ejercicio: Conectar al sistema desde Windows y crear una base de datos.</p>
<p>Generalmente el mejor modo de mantener la información en la base de datos es utilizando
un usuario distinto a <em>postgres</em>, que sólo debería usarse para tareas administrativas. Es
posible incluso crear más de un usuario con diferentes derechos (SELECT, INSERT, UPDATE,
DELETE) para tener un entorno más seguro. Sin embargo, esto queda fuera del ámbito
de este tutorial y se conectará siempre con el usuario <em>postgres</em>.</p>
</div>
<div class="section" id="acceso-a-una-base-de-datos">
<h2>Acceso a una base de datos<a class="headerlink" href="#acceso-a-una-base-de-datos" title="Permalink to this headline">¶</a></h2>
<p>Una vez la base de datos ha sido creada es posible utilizar un cliente para conectar a ella. Existen varias maneras:</p>
<ul class="simple">
<li>psql: el programa de terminal interactivo de PostgreSQL que permite introducir de forma interactiva, editar y ejecutar comandos SQL. Veremos más adelante qué es SQL. Es el que utilizaremos.</li>
<li>una herramienta existente con interfaz gráfica, como pgAdmin, que veremos brevemente.</li>
<li>una aplicación personalizada desarrollada con algún lenguaje para el que haya un driver de acceso. Esta posibilidad no se trata en esta formación.</li>
</ul>
<p>Para conectar con pgAdmin se deberá seleccionar el menu File &gt; Add Server y registrar el nuevo servidor con su dirección IP y el puerto en el que está escuchando (5432 por defecto). También habrá que indicar el nombre de usuario con el que se desea hacer la conexión.</p>
<p>Una vez se tiene configurada una entrada para la base de datos en pgAdmin, es posible
conectar a dicho servidor haciendo doble click en dicha entrada.</p>
<img alt="../_images/training_postgresql_connect_pgadmin.png" src="../_images/training_postgresql_connect_pgadmin.png" />
<p>Una vez creada, es posible selecionar la nueva base de datos y mostrar el árbol de
objetos que contiene. Se puede ver el esquema &#8220;public&#8221; que no contiene ningún elemento.</p>
<p>Para seguir interactuando con la base de datos abriremos una ventana SQL clicando sobre
el siguiente icono:</p>
<img alt="../_images/training_postgresql_open_sql.png" src="../_images/training_postgresql_open_sql.png" />
<p>Que abrirá una ventana que permite enviar comandos SQL al servidor de base de datos. Probemos
con los siguientes comandos:</p>
<div class="highlight-python"><pre>SELECT version ();
SELECT current_date;
SELECT 2 + 2;</pre>
</div>
</div>
<div class="section" id="psql">
<h2>psql<a class="headerlink" href="#psql" title="Permalink to this headline">¶</a></h2>
<p>También podemos conectar a la base de datos con psql. Podemos conectar con psql desde cualquier máquina que tenga una versión de psql compatible con el servidor. El propio servidor tiene dicho programa instalado y es obviamente compatible por lo que la mejor opción es acceder al servidor:</p>
<div class="highlight-python"><pre>$ ssh geo@190.109.197.226</pre>
</div>
<p>Es posible especificar al comando <tt class="docutils literal"><span class="pre">psql</span></tt> la base de datos a la que se quiere acceder, el usuario con el que se quiere realizar el acceso y la instrucción que se quiere ejecutar en el sistema. Los valores concretos utilizados dependerán de la configuración concreta del servidor. En adelante usaremos el usuario de base de datos <tt class="docutils literal"><span class="pre">postgres</span></tt> y la base de datos <tt class="docutils literal"><span class="pre">geoserverdata</span></tt>.</p>
<p>La siguiente instrucción invoca la función <tt class="docutils literal"><span class="pre">version</span></tt>:</p>
<div class="highlight-python"><pre>$ psql -U postgres -d test_database -c "SELECT version ()"
                                                  version
------------------------------------------------------------------------------------------------------------
 PostgreSQL 9.1.5 on x86_64-unknown-linux-gnu, compiled by gcc (Ubuntu/Linaro 4.6.3-1ubuntu5) 4.6.3, 64-bit
(1 row)</pre>
</div>
<p>Otros ejemplos:</p>
<div class="highlight-python"><pre>$ psql -U postgres -d test_database -c "SELECT current_date"
    date
------------
 2012-09-11
(1 row)

$ psql -U postgres -d test_database -c "SELECT 2 + 2"
 ?column?
----------
        4
(1 row)</pre>
</div>
<p>Todos estos comandos SQL pueden ser ejecutados usando otro parámetro del programa <tt class="docutils literal"><span class="pre">psql</span></tt>. La opción -f permite especificar un fichero que contiene instrucciones SQL. Así, por ejemplo sería posible crear un fichero en <tt class="docutils literal"><span class="pre">/tmp/mi_script.sql</span></tt> con el siguiente contenido:</p>
<div class="highlight-python"><pre>SELECT version ();
SELECT current_date;
SELECT 2 + 2;</pre>
</div>
<p>Y ejecutarlo con la instrucción:</p>
<div class="highlight-python"><pre>$ psql -U geoserver -d geoserverdata -f /tmp/mi_script.sql

                                               version
------------------------------------------------------------------------------------------------------
 PostgreSQL 9.1.11 on i686-pc-linux-gnu, compiled by gcc (Ubuntu/Linaro 4.6.3-1ubuntu5) 4.6.3, 32-bit
(1 row)

    date
------------
 2014-02-11
(1 row)

 ?column?
----------
        4
(1 row)</pre>
</div>
<p>Como se puede observar, se ejecutan todos los comandos del script sql uno detrás de otro.</p>
</div>
<div class="section" id="consola-psql-interactiva">
<h2>Consola psql interactiva<a class="headerlink" href="#consola-psql-interactiva" title="Permalink to this headline">¶</a></h2>
<p>También es posible, y conveniente para tareas de mayor complejidad, entrar al modo interactivo de <tt class="docutils literal"><span class="pre">psql</span></tt>. Para ello podemos omitir el parámetro -c:</p>
<div class="highlight-python"><pre>$ psql -U postgres -d test_database</pre>
</div>
<p>o conectar sin especificar la base de datos y usar el comando \c dentro de <em>psql</em>:</p>
<div class="highlight-python"><pre>$ psql -U postgres
=# \c test_database
You are now connected to database "mibd" as user "postgres".</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Dado que psql es un programa en línea de comandos tenemos que diferenciar en la documentación las instrucciones que se deben de ejecutar en la línea de comandos del sistema operativo y la línea de comandos de psql. Las primeras, como se comentó en la introducción a Linux, vienen precedidas del símbolo del dólar ($) mientras que para las últimas utilizaremos un par de símbolos: =#. Es necesario prestar atención a este detalle durante el resto de la documentación.</p>
</div>
<p>En el resto de la documentación se seguirán enviando comandos SQL desde la línea de comandos del sistema operativo ($) usando el parámetro -c o el parámetro -f, como especificado anteriormente. Sin embargo, se especifica a continuación una mínima referencia sobre los comandos que se pueden ejecutar en la línea de comandos de postgresql (=#)</p>
<p>Para obtener el listado de las bases de datos existentes en el sistema, usar el comando
\l:</p>
<div class="highlight-python"><pre>=# \l</pre>
</div>
<p>Y para listar tablas del esquema por defecto de la base de datos actual (<em>public</em>):</p>
<div class="highlight-python"><pre>=# \dt</pre>
</div>
<p>Si queremos listar las tablas que hay en otro esquema es posible utilizar la siguiente sintaxis:</p>
<div class="highlight-python"><pre>=# \dt gis.*</pre>
</div>
<p>Por último, para obtener información sobre cualquier objeto de la base de datos es posible
utilizar el comando \d:</p>
<div class="highlight-python"><pre>=# \d gis.categorias</pre>
</div>
<p>Se puede añadir un + para obtener información más detallada:</p>
<div class="highlight-python"><pre>=# \d+ gis.categorias</pre>
</div>
<div class="section" id="ayuda-de-psql">
<h3>Ayuda de psql<a class="headerlink" href="#ayuda-de-psql" title="Permalink to this headline">¶</a></h3>
<p>Para una completa referencia de los comandos disponibles es posible usar el comando \?:</p>
<div class="highlight-python"><pre>=# \?</pre>
</div>
<p>que nos abrirá la ayuda. El formato de la ayuda es el mismo que el del comando <em>less</em>.</p>
</div>
</div>
<div class="section" id="cargando-informacion-desde-shapefile-shp2pgsql">
<h2>Cargando información desde shapefile: shp2pgsql<a class="headerlink" href="#cargando-informacion-desde-shapefile-shp2pgsql" title="Permalink to this headline">¶</a></h2>
<p>El parámetro -f es extremadamente útil cuando queremos usar PostgreSQL junto con su extensión espacial PostGIS para la carga de datos desde shapefile. Para ello contamos con <tt class="docutils literal"><span class="pre">shp2pgsql</span></tt>, que es capaz de generar un script SQL a partir de un shapefile que al ejecutar en PostgreSQL generará una tabla espacial con los mismos datos del shapefile.</p>
<p>La sintaxis básica es sencilla:</p>
<div class="highlight-python"><pre>shp2pgsql &lt;shapefile&gt; &lt;nombre_de_tabla_a_crear&gt;</pre>
</div>
<p>Por ejemplo:</p>
<div class="highlight-python"><pre>$ shp2pgsql provincias.shp provincia</pre>
</div>
<p>El comando anterior realmente muestra por pantalla el script, lo cual no es muy útil y además tarda mucho tiempo (con Ctrl+C es posible cancelar la ejecución en la mayoría de los casos). Para que realmente sea útil tenemos que almacenar los datos en un fichero que luego podamos pasar a psql con el parámetro -f. Esto lo podemos hacer mediante redireccionando la salida estándar a un fichero temporal:</p>
<div class="highlight-python"><pre>$ shp2pgsql provincias.shp provincias &gt; /tmp/provincias.sql</pre>
</div>
<p>Es posible que durante este proceso obtengamos un error similar a éste:</p>
<div class="highlight-python"><pre>Unable to convert data value to UTF-8 (iconv reports "Invalid or incomplete multibyte or wide character"). Current encoding is "UTF-8". Try "LATIN1" (Western European), or one of the values described at http://www.postgresql.org/docs/current/static/multibyte.html.</pre>
</div>
<p>lo cual quiere decir que la codificación utilizada para almacenar los textos en el fichero .dbf no es UTF-8, que es la que espera el programa <tt class="docutils literal"><span class="pre">shp2pgsql</span></tt> por defecto. También nos sugiere que intentemos LATIN1. Para decirle al programa qué codificacion utilizamos, podemos especificar el parámetro -W:</p>
<div class="highlight-python"><pre>$ shp2pgsql -W LATIN1 provincias.shp provincias &gt; /tmp/provincias.sql</pre>
</div>
<p>Y si nuestros datos están en LATIN1 se generará el script sin ningún problema.</p>
<p>A continuación no tenemos más que cargar el fichero recién generado con psql:</p>
<div class="highlight-python"><pre>$ psql -U postgres -d geoserverdata -f /tmp/provincias.sql</pre>
</div>
<p>Tras la ejecución podemos ver con cualquier sistema GIS que soporte conexiones PostGIS 2.0 (como QGis) que se ha creado una tabla en PostreSQL/PostGIS con los mismos datos que contenía el shapefile.</p>
<p>El siguiente aspecto que tenemos que tener en cuenta, es que el sistema de referencia de coordenadas (CRS) no está especificado. Por ejemplo, ejecutando esta instrucción:</p>
<div class="highlight-python"><pre>$ psql -U postgres -d geoserverdata -c "select * from geometry_columns"

 f_table_catalog | f_table_schema |      f_table_name       | f_geometry_column | coord_dimension | srid |      type
-----------------+----------------+-------------------------+-------------------+-----------------+------+-----------------
 geoserverdata   | public         | provincias              | geom              |               2 |    0 | MULTIPOLYGON</pre>
</div>
<p>podemos observar que la tabla recién creada tiene un campo srid, que indica el código EPSG del sistema de coordenadas utilizado, con valor igual a 0. Para evitar esto es posible utilizar el parámetro -s de <tt class="docutils literal"><span class="pre">shp2pgsql</span></tt>:</p>
<div class="highlight-python"><pre>$ shp2pgsql -s 4326 provincias.shp provincias &gt; /tmp/provincias.sql</pre>
</div>
<p>que establecerá que nuestros datos están en EPSG:4326 (o el CRS que se especifique).</p>
<p>Por último, es recomendable crear nuestros datos en un esquema distinto de <tt class="docutils literal"><span class="pre">public</span></tt> para facilitar las copias de seguridad y las actualizaciones de PostGIS, por motivos que no se tratan en esta documentación:</p>
<div class="highlight-python"><pre>$ psql -U postgres -d geoserverdata -c "create schema gis"
CREATE SCHEMA
$ shp2pgsql -s 4326 provincias.shp gis.provincias &gt; /tmp/provincias.sql</pre>
</div>
<p>Incluso es posible cargar en PostgreSQL el fichero resultante con una única línea, sólo enlazando la salida de <tt class="docutils literal"><span class="pre">shp2pgsql</span></tt> con la entrada de <tt class="docutils literal"><span class="pre">psql</span></tt> mediante una tubería de linux &#8220;|&#8221;:</p>
<div class="highlight-python"><pre>$ shp2pgsql -s 4326 provincias.shp gis.provincias | psql -U postgres -d geoserverdata</pre>
</div>
<p>Por ejemplo los siguientes comandos cargan una serie de datos en PostGIS, en la base de datos <tt class="docutils literal"><span class="pre">geoserver</span></tt>:</p>
<div class="highlight-python"><pre>$ psql -U postgres -d geoserver -c "create schema gis"
$ shp2pgsql -s 4326 -W LATIN1 /tmp/datos/ARG_adm0.shp gis.admin0 | psql -U postgres -d geoserverdata
$ shp2pgsql -s 4326 -W LATIN1 /tmp/datos/ARG_adm1.shp gis.admin1 | psql -U postgres -d geoserverdata
$ shp2pgsql -s 4326 -W LATIN1 /tmp/datos/ARG_adm2.shp gis.admin2 | psql -U postgres -d geoserverdata
$ shp2pgsql -s 4326 -W LATIN1 /tmp/datos/ARG_rails.shp gis.ferrovia | psql -U postgres -d geoserverdata
$ shp2pgsql -s 4326 -W LATIN1 /tmp/datos/ARG_roads.shp gis.vias | psql -U postgres -d geoserverdata
$ shp2pgsql -s 4326 -W LATIN1 /tmp/datos/ARG_water_areas_dcw.shp gis.zonas_agua | psql -U postgres -d geoserverdata
$ shp2pgsql -s 4326 -W LATIN1 /tmp/datos/ARG_water_lines_dcw.shp gis.lineas_agua | psql -U postgres -d geoserverdata</pre>
</div>
<p>Nótese que todos estos pasos se pueden simplificar en sólo dos, que cargarían todos los shapefiles de un directorio:</p>
<div class="highlight-python"><pre>$ psql -U postgres -d geoserver -c "create schema gis"
$ for i in `ls /tmp/datos/*.shp`; do shp2pgsql -s 4326 $i gis.${i%.shp} | psql -U postgres -d geoserverdata; done</pre>
</div>
<p>El siguiente ejemplo crea una base de datos llamada <tt class="docutils literal"><span class="pre">analisis</span></tt> y dentro de ella un esquema llamado <tt class="docutils literal"><span class="pre">gis</span></tt>. Luego se instala la extensión PostGIS y por último se cargan en la base de datos todos los shapefiles existentes en el directorio <tt class="docutils literal"><span class="pre">Escritorio/datos/analisis</span></tt>:</p>
<div class="highlight-python"><pre>$ psql -U postgres -c "create database analisis"
$ psql -U postgres -d analisis -c "create schema gis"
$ psql -U postgres -d analisis -c "create extension postgis"
$ for i in `ls /tmp/datos/analisis/*.shp`; do shp2pgsql -s 25830 $i gis.${i%.shp} | psql -U postgres -d analisis; done</pre>
</div>
</div>
<div class="section" id="mas-informacion">
<h2>Más información<a class="headerlink" href="#mas-informacion" title="Permalink to this headline">¶</a></h2>
<p>La página web de <em>PostgreSQL</em> se puede consultar aquí <a class="footnote-reference" href="#id5" id="id1">[1]</a>. En ella hay abundante información en inglés <a class="footnote-reference" href="#id6" id="id2">[2]</a>,
así como listas de correo en español <a class="footnote-reference" href="#id7" id="id3">[3]</a>.</p>
<p>También se puede descargar un curso de PostGIS de bastante difusión <a class="footnote-reference" href="#id8" id="id4">[4]</a>.</p>
</div>
<div class="section" id="referencias">
<h2>Referencias<a class="headerlink" href="#referencias" title="Permalink to this headline">¶</a></h2>
<table class="docutils footnote" frame="void" id="id5" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td><a class="reference external" href="http://www.postgresql.org">http://www.postgresql.org</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id6" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td><a class="reference external" href="http://www.postgresql.org/docs/9.2/static/index.html">http://www.postgresql.org/docs/9.2/static/index.html</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id7" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[3]</a></td><td><a class="reference external" href="http://archives.postgresql.org/pgsql-es-ayuda/">http://archives.postgresql.org/pgsql-es-ayuda/</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id8" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id4">[4]</a></td><td><a class="reference external" href="http://blog.lookingformaps.com/2012/11/publicada-documentacion-del-curso-bases.html">http://blog.lookingformaps.com/2012/11/publicada-documentacion-del-curso-bases.html</a></td></tr>
</tbody>
</table>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2013, Varios.<br/>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.<br/>
    </p>
  </div>
</footer>
  </body>
</html>