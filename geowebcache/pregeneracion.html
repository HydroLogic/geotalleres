
<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Pregeneración de teselas en GeoWebCache &mdash; geotalleres-teoria 1 documentation</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/geotalleres.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootswatch-3.1.0/readable/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.1.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="geotalleres-teoria 1 documentation" href="../index.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body>

  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          GeoTalleres</a>
        <span class="navbar-text navbar-version pull-left"><b>1</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Nav <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../geopython/index.html">Geoprocesamiento con Python</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../geopython/miniintro_python.html">Mini intro a python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geopython/librerias.html">Librerías GEO interesantes en Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geopython/instalacion.html">Instalación</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geopython/rasterio.html">rasterio</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geopython/fiona.html">fiona</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geopython/shapely.html">shapely</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geopython/fiona_shapely.html">fiona y shapely</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Pregeneración de teselas en GeoWebCache</a><ul>
<li><a class="reference internal" href="#pregeneracion-de-teselas">Pregeneración de teselas</a></li>
<li><a class="reference internal" href="#ejemplo-pregeneracion-de-unidades-administrativas-de-ecuador">Ejemplo: pregeneración de unidades administrativas de Ecuador</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
              
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="../_sources/geowebcache/pregeneracion.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12">
      
  <div class="section" id="pregeneracion-de-teselas-en-geowebcache">
<h1>Pregeneración de teselas en GeoWebCache<a class="headerlink" href="#pregeneracion-de-teselas-en-geowebcache" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Fecha</th>
<th class="head">Autores</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>20 Enero 2014</td>
<td><ul class="first last simple">
<li>Fernando González (<a class="reference external" href="mailto:fernando&#46;gonzalez&#37;&#52;&#48;fao&#46;org">fernando<span>&#46;</span>gonzalez<span>&#64;</span>fao<span>&#46;</span>org</a>)</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>©2013 FAO Forestry</p>
<p class="last">Excepto donde quede reflejado de otra manera, la presente documentación se halla bajo licencia : Creative Commons (Creative Commons - Attribution - Share Alike: <a class="reference external" href="http://creativecommons.org/licenses/by-sa/3.0/deed.es">http://creativecommons.org/licenses/by-sa/3.0/deed.es</a>)</p>
</div>
<div class="section" id="pregeneracion-de-teselas">
<h2>Pregeneración de teselas<a class="headerlink" href="#pregeneracion-de-teselas" title="Permalink to this headline">¶</a></h2>
<p>Hay dos maneras de generar las teselas de GeoWebCache. La primera forma consiste en generar progresivamente mientras se visualiza el mapa. En este caso, las teselas se almacenan en caché a medida que son solicitadas a través de la navegación por mapa (por ejemplo, en OpenLayers). La primera vez que se solicita una tesela, esta se servirá a la misma velocidad que en el caso de una solicitud WMS estándar, ya que ésta se ha de generar y guardar en la caché. La veces siguientes, la tesela ya estará generada y almacenada en la caché por lo que el tiempo de respuesta de la petición será mucho menor. La principal ventaja de este método es que no requiere ningún procesamiento previo y que sólo los datos que ha solicitado se almacenan en caché, ahorrando potencialmente espacio en disco. La desventaja de este método es que el mapa se visualiza con velocidad muy variable, lo que reduce la calidad de la experiencia del usuario.</p>
<p>La otra forma de rellenar la caché es mediante pregeneración. La pregeneración es el proceso en el que se generan y almacenan en caché todas las teselas deseadas. Cuando este proceso se usa inteligentemente, la experiencia de usuario mejora en gran medida ya que las teselas se encuentran todas pregeneradas y el usuario no tiene que sufrir tiempos de espera largos. La desventaja de este proceso es que la pregeneración puede ser muy costosa en tiempo y en espacio en disco.</p>
<p>En la práctica se utiliza una combinación de ambos métodos, pregenerando a ciertos niveles de zoom (o en determinadas zonas de los niveles de zoom) y dejando las teselas menos utilizadas sin pregenerar.</p>
</div>
<div class="section" id="ejemplo-pregeneracion-de-unidades-administrativas-de-ecuador">
<h2>Ejemplo: pregeneración de unidades administrativas de Ecuador<a class="headerlink" href="#ejemplo-pregeneracion-de-unidades-administrativas-de-ecuador" title="Permalink to this headline">¶</a></h2>
<p>En el ejemplo que nos ocupa vamos a pregenerar las teselas para el mapa de Ecuador que se puede ver en la figura, en el sistema de referencia EPSG:900913:</p>
<img alt="../_images/mapa_a_optimizar.png" src="../_images/mapa_a_optimizar.png" />
<p>Para ello tenemos que acceder a la URL <tt class="docutils literal"><span class="pre">geoserver/gwc</span></tt> dentro de nuestro servidor, por ejemplo <tt class="docutils literal"><span class="pre">http://127.0.0.1:8080/geoserver/gwc/</span></tt> si estamos accediendo desde la máquina local.</p>
<p>Nos aparecerá la página principal de GeoWebCache, y deberemos acceder al enlace donde se listan todas las capas:</p>
<img alt="../_images/enlace_lista_capas.png" src="../_images/enlace_lista_capas.png" />
<p>Una vez seguido el enlace nos aparecerá una página con las capas existentes en la caché. Podemos observar cómo debajo de cada capa hay un enlace con el texto &#8220;Seed this layer&#8221;, que nos permite pregenerar la caché.</p>
<img alt="../_images/lista_capas.png" src="../_images/lista_capas.png" />
<p>Siguiendo dicho enlace llegaremos a la página que nos permite pregenerar la caché en un formulario al final de la misma:</p>
<img alt="../_images/formulario_pregeneracion.png" src="../_images/formulario_pregeneracion.png" />
<p>En él podemos observar que se nos piden distintos parámetros, de los que destacamos:</p>
<ul class="simple">
<li>Type of operation (Tipo de operación): Generalmente seleccionaremos siempre &#8220;Seed&#8221;, o sea, pregeneración.</li>
<li>Grid Set: En este punto seleccionaremos el sistema de referencia de nuestro mapa.</li>
<li>Formato: Muy importante seleccionar el formato de imagen que estamos usando en las llamadas de nuestro mapa al servidor. En nuestro caso image/png</li>
<li>Zoom start y Zoom stop: Esto son los niveles de zoom para los cuales se generarán las teselas.</li>
<li>STYLES: El estilo con el que se generarán las teselas.</li>
<li>Bounding box: Extensión de nuestros datos que define las teselas que se generarán. Por defecto se toma la extensión de la capa.</li>
</ul>
<p>Casi todas las opciones son sencillas de seleccionar. Sin embargo, para los niveles de zoom nos puede surgir una duda ¿a qué escala corresponde cada nivel de zoom?</p>
<p>Si bien la respuesta exacta es complicada de obtener, es bastante sencillo hacerse una idea intuitiva. Para ello tenemos que volver a la página que lista las capas y ver que a la derecha aparecen demos con OpenLayers para los distintos sistemas de referencia y para cada formato de imagen:</p>
<img alt="../_images/lista_capas_demos.png" src="../_images/lista_capas_demos.png" />
<p>Pinchando en el que nos interesa EPSG:900913 y png podemos acceder a una página de demostración en la que aparece una barra de zoom con los niveles de GeoWebCache. Podemos navegar e identificar los niveles a los que queremos acceder, teniendo en cuenta que el más alejado corresponde con el nivel 0. Por ejemplo, la capa aparece dibujada inicialmente en el nivel de zoom 6:</p>
<img alt="../_images/nivel_zoom_6.png" src="../_images/nivel_zoom_6.png" />
<p>Si nos movemos al nivel 12, podemos observar que tal vez sea el nivel máximo al cual queramos visualizar la imagen:</p>
<img alt="../_images/nivel_zoom_12.png" src="../_images/nivel_zoom_12.png" />
<p>Con lo cual ya tenemos los parámetros necesarios para pregenerar la caché. Volviendo al formulario, podemos especificar los parámetros y, tras pulsar en el botón &#8220;Submit&#8221;, se iniciará una tarea que se reporta más arriba en la página:</p>
<img alt="../_images/reporte_pregeneracion.png" src="../_images/reporte_pregeneracion.png" />
<p>Una vez generada, cada vez que el usuario se mueva en un mapa entre los niveles 6 y 12 de zoom se obtendrán las imágenes desde la caché, por lo que la navegación será muy rápida, mientras que a distintos niveles de zoom la velocidad decrecerá porque el servidor tendrá que dibujar las teselas.</p>
<p>El resultado de la caché se guarda internamente en el directorio de datos de GeoServer. Así, si dicho directorio es <tt class="docutils literal"><span class="pre">/var/geoserver/data</span></tt>, la caché se almacena en <tt class="docutils literal"><span class="pre">/var/geoserver/data/gwc</span></tt>, en un subdirectorio para cada capa. El resultado de la pregerenación de la caché ocupa 87Mb en el directorio <tt class="docutils literal"><span class="pre">/var/geoserver/data/gwc/nfms_ecuador2</span></tt>.</p>
<p>En la práctica, es bastante barato generar los primeros niveles, de 0 a 6, ya que al ser escalas muy pequeñas (zooms muy lejanos), con pocas teselas se cubre rápidamente la extensión de la capa. Sin embargo, es a escalas más grandes cuando cuesta cada vez más tiempo la generación de la caché para el nivel de zoom y más espacio almacenarlo. Por ejemplo, la generación del nivel 13, nos hace pasar de 87Mb a 319Mb. Y si observamos dentro del directorio <tt class="docutils literal"><span class="pre">/var/geoserver/data/gwc/nfms_ecuador2</span></tt> podemos ver que cada nivel de zoom casi cuadriplica el tamaño del nivel anterior:</p>
<div class="highlight-python"><pre>12K     EPSG_900913_00
16K     EPSG_900913_01
24K     EPSG_900913_02
28K     EPSG_900913_03
32K     EPSG_900913_04
64K     EPSG_900913_05
104K    EPSG_900913_06
224K    EPSG_900913_07
608K    EPSG_900913_08
1.8M    EPSG_900913_09
5.2M    EPSG_900913_10
18M     EPSG_900913_11
62M     EPSG_900913_12
233M    EPSG_900913_13</pre>
</div>
<p>Entre las prácticas que reducen el coste temporal y espacial de la caché está la de evitar la pregeneración de zonas sin interés. En el caso de Ecuador, es obvio que a partir del nivel de zoom 7 u 8, no tiene sentido pregenerar las teselas que corresponden al agua entre Islas Galápagos y el continente. Esto se puede regular con la opción <tt class="docutils literal"><span class="pre">bounding</span> <span class="pre">box</span></tt> del formulario de pregeneración.</p>
<p>Por último, en el caso de teselas cuyo renderizado no contenga más de 256 colores, es posible utilizar el formato PNG8, que ocupa algo menos que el formato PNG, lo cual se traduce en menor espacio para almacenar las teselas de la caché así como en menor tiempo de transmisión entre el servior y el mapa cliente. Para ello, hay que habilitar dicho formato en GeoServer, yendo a la pestaña &#8220;Cacheado de Teselas&#8221; de la capa y habilitando el formato en la sección &#8220;Cache image formats&#8221;:</p>
<img alt="../_images/png8_habilitado.png" src="../_images/png8_habilitado.png" />
<p>Tras guardar los cambios, seremos capaces de seleccionar dicho formato en el formulario de pregeneración. Como comparativa, el resultado de pregenerar los niveles de 6 a 12 es 78Mb, un 10% menor que los 87Mb correspondientes al formato PNG.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">En caso de aplicar esta optimización, hay que asegurarse de que el cliente pide las teselas en el formato <tt class="docutils literal"><span class="pre">image/png8</span></tt>.</p>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2013, Varios.<br/>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.<br/>
    </p>
  </div>
</footer>
  </body>
</html>